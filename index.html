<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <div class='navigation'>
      <button type='button' class='refresh-tweets'>Refresh</button>
    </div>
    <div class='tweets-container'>
    </div>
    <script>

    var indexTracker;

      $(document).ready(function(){
        
        //Commented out otherwise it clears the body
        // var $body = $('body');
        // $body.html('');

        // for testing a single round
        // var startIndex = streams.home.length - 1;
        // addNewTweets(startIndex,0);

        scheduleRefreshTweets(0,1);  //second item is to limit number of rounds for testing purposes. To be removed

        $('.navigation').on('click','.refresh-tweets', function() {return scheduleRefreshTweets(indexTracker)});

        

      }); //end of ready function

      var addNewTweets = function(startIndex,endIndex) {
        indexTracker = startIndex; //updates Global variable
        var index = startIndex;
        while(index >= endIndex){
          var tweet = streams.home[index];

          var $tweet = createTweetElement(tweet.user, tweet.message, tweet.created_at);

          // var $tweet = $('<div></div>');
          // $tweet.text('@' + tweet.user + ': ' + tweet.message);

          $tweet.prependTo($('.tweets-container'));
          index -= 1;
        }
      }

      var createTweetElement = function (username,message,timestamp) {
        var container = $('<div class="tweet"></div>');

        var $user = createSpanElement('@' + username,'user');
        var $message = createSpanElement(': ' + message,'message');
        var $timestamp = createSpanElement(' -' + timestamp,'timestamp');
        // var user = $('<span class= "user">'+ username'</span>');
        // var message = $('<span class= "message">'+ message'</span>');

        container.append($user)
                 .append($message)
                 .append($timestamp);
        return container;
      }

      var createSpanElement = function(value, classValue) {
        return $('<span class =' +  classValue + '>' + value + '</span>');
      }

      var scheduleRefreshTweets = function(endIndex,roundsLeft) {
        var startIndex = streams.home.length - 1;
        addNewTweets(startIndex,endIndex);

        //alert(roundsLeft); For testing purposes
        

        if(roundsLeft > 0) {
          roundsLeft -- ;
          setTimeout(function () {
            return scheduleRefreshTweets(endIndex, roundsLeft);
          }, 1500);        
        }
      }



    </script>
  </body>
</html>
